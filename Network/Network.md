# 1 基础

把计算机网络接入互联网，就必须使用TCP/IP协议

TCP/IP协议泛指互联网协议，其中最重要的两个协议是TCP协议和IP协议

## 1.1 IP 地址

在互联网中，一个IP地址用于唯一标识一个网络接口（Network Interface）

一台联入互联网的计算机肯定有一个IP地址，但也可能有多个IP地址

如果一台计算机只有一个网卡，并且接入了网络，那么，它有一个本机地址`127.0.0.1`，还有一个IP地址，例如`101.202.99.12`，可以通过这个IP地址接入网络



IP地址分为

1. IPv4：32位地址，类似`101.202.99.12`；实际上是一个32位整数，总共有大约42亿个，目前已耗尽

2. IPv6：128位地址，类似`2001:0DA8:100A:0000:0000:1020:F2F3:1428`

   a. 公网IP地址：可以直接被访问，

   b. 内网IP地址：只能在内网访问，形如`192.168.x.x`, `10.x.x.x`



如果两台计算机位于同一个网络，那么他们之间可以直接通信，因为他们的IP地址前段是相同的，也就是网络号是相同的

IP地址通过子网掩码过滤得到网络号

```
IP = 101.202.99.2
Mask = 255.255.255.0
Network = IP & Mask = 101.202.99.0
```

如果两台计算机计算出的网络号不同，那么两台计算机不在同一个网络，不能直接通信，它们之间必须通过路由器或者交换机这样的网络设备间接通信，我们把这种设备称为**网关**

网关的作用就是连接多个网络，负责把来自一个网络的数据包发到另一个网络，这个过程叫**路由**

## 1.2 域名

记忆IP地址是很难的，所以我们通常使用域名访问某个特定的服务

**DNS 域名解析服务器 **负责把域名翻译成对应的IP，客户端再根据IP地址访问服务器

本机域名`localhost`，对应本机地址`127.0.0.1`

## 1.3 网络模型

OSI（Open System Interconnect）网络模型：ISO组织定义的一个计算机互联的标准模型，7层

- 应用层，提供应用程序之间的通信；
- 表示层：处理数据格式，加解密等等；
- 会话层：负责建立和维护会话；
- 传输层：负责提供端到端的可靠传输；
- 网络层：负责根据目标地址选择路由来传输数据；
- 链路层和物理层负责把数据进行分片并且真正通过物理网络传输，例如，无线网、光纤等。



互联网实际使用的TCP/IP模型：大致对应OSI的5层模型

- 应用层 - 应用、表示、会话

- 传输层 - 传输
- IP层 - 网络
- 网络接口层 - 链路、物理



- IP协议是一个分组交换，只负责发数据包，不保证顺序和正确性
- TCP协议是传输控制协议，它是面向连接的协议，支持可靠传输和双向通信
  - TCP协议建立在IP协议之上，在传输数据之前需要先建立连接，然后传输数据，传输完后还需要断开连接
- UDP协议数据报文协议，无连接协议，不保证可靠传输
  - 因为UDP协议在通信前不需要建立连接，因此它的传输效率比TCP高
  - UDP协议时，传输的数据通常是能容忍丢失的



---



# 2 TCP 编程

## Socket

个应用程序通过一个Socket来建立一个远程连接，而Socket内部通过TCP/IP协议把数据传输到网络

```ascii
┌───────────┐                                 ┌───────────┐
│Application│                                 │Application│
├───────────┤                                 ├───────────┤
│  Socket   │                                 │  Socket   │
├───────────┤                                 ├───────────┤
│    TCP    │                                 │    TCP    │
├───────────┤      ┌──────┐      ┌──────┐     ├───────────┤
│    IP     │◀───▶│Router│◀───▶│Router│◀───▶│    IP     │
└───────────┘      └──────┘      └──────┘     └───────────┘
```

当操作系统接收到一个数据包的时候，如果只有IP地址，它没法判断应该发给哪个应用程序，所以，操作系统抽象出Socket接口，每个应用程序需要各自对应到不同的Socket，数据包才能根据Socket正确地发到对应的应用程序



一个Socket就是由IP地址和端口号（范围是0～65535）组成，端口号总是由操作系统分配

小于1024的端口属于*特权端口*，需要管理员权限，大于1024的端口可以由任意用户的应用程序打开



使用Socket进行网络编程时，本质上就是两个进程之间的网络通信

其中一个进程必须充当服务器端，它会主动监听某个指定的端口

​	服务器端的Socket是指定的IP地址和指定的端口号

另一个进程必须充当客户端，它必须主动连接服务器的IP地址和指定端口

​	客户端的Socket是它所在计算机的IP地址和一个由操作系统分配的随机端口号

如果连接成功，服务器端和客户端就成功地建立了一个TCP连接，双方后续就可以随时发送和接收数据